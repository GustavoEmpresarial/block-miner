#!/usr/bin/env bash
# Pre-commit hook: scan config/*.json for suspicious secrets
set -e
echo "Running local config-guard pre-commit checks..."
FOUND=0
for f in config/*.json; do
  if [ -f "$f" ]; then
    if grep -Ei "(PRIVATE|MNEMONIC|SECRET|KEY|PASSPHRASE)" "$f" >/dev/null; then
      echo "Potential secret keywords found in $f"
      FOUND=1
    fi
    if grep -Eo "0x[0-9a-fA-F]{40,}" "$f" >/dev/null; then
      echo "Potential hex private key found in $f"
      FOUND=1
    fi
    if grep -Eo "[0-9a-fA-F]{64,}" "$f" >/dev/null; then
      echo "Potential long hex string found in $f"
      FOUND=1
    fi
  fi
done
if [ "$FOUND" -ne 0 ]; then
  echo "Config check failed: remove secrets from config/*.json or move to .env" >&2
  exit 1
fi
echo "Config checks passed."
exit 0
